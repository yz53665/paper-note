
# 概述

决策规划层次：
+ 全局路径规划（Route Planning）
	+ 输入：目的地，地图信息
	+ 输出：全局路径
+ 行为决策（Behavioral Layer）
	+ 输入：全局路径、环境信息
	+ 输出：具体决策（转弯、变道、跟随）
+ 运动规划（Motion Planning）
	+ 输入：行为决策、约束条件（避免碰撞、乘客舒适性）
	+ 输出：具体轨迹
# 1. 全局路径规划
输入包含每条车道在内的更多信息的高精度地图
![[Pasted image 20240315212405.png](attach/Pasted%20image%2020240315212405.png)
### 1.1 Dijkstra算法
1. 计算每个节点距离起点的移动代价
2. 节点放入队列按照代价排序
3. 每次遍历从队列中选出代价最小的作为下个遍历节点

##### 优点：
+ 路径最优
##### 缺点：
+ 计算复杂度高O($N^2$)

### 1.2 A\*算法
加入启发函数引导搜索过程

# 2. 行为决策
需要解决的关键问题是：在多智能体决策的复杂环境中，存在感知不确定性的规划问题。
### 2.1 有限状态机模型
通过构建有限的有向连通图来描述不同驾驶状态与状态之间的转移关系，根据当前状态反应式生成驾驶动作。是目前应用最广的决策模型。

##### 优点
+ 简单、易行

##### 缺点
+ 忽略环境动态性和不确定性
+ 场景特征较多使得状态划分和管理繁琐

##### 2.2 决策树模型
和状态机类似，但将逻辑固化到树形结构中，通过自顶向下轮询搜索。

##### 优点
+ 可视化的控制逻辑
+ 控制节点可复用

##### 缺点
+ 每个场景离线定义决策网络，状态空间行为空间大时控制逻辑复杂
+ 无法考虑不确定性因素

##### 2.3 基于知识推理的决策模型
由“场景特征——驾驶动作”的映射关系模仿人类驾驶员的行为决策过程。该来模型将驾驶知识存是在知识库或神经网络中。进而通过“查询”机制从知识库或者网络结构中推理驾驶动作。

##### 优点
+ 省去数据标注和知识整合过程
###### 缺点
+ 对先验驾驶知识和训练数据依赖大
+ 解释性差
+ 透明性差，实际出现问题可追溯性差

##### 2.4 基于价值的决策模型
根据最大效用理论，依据选择准则在多个备选方案中选择最优驾驶策略。
为了评估驾驶动作的好坏程度，定义了效用（utility）或价值（value）函数，根据某些准则属性定量评估驾驶任务目标的程度，如安全性、舒适度、行车效率。

# 3. 运动规划
将“行为”转换为“轨迹”。
### 3.1 路径规划（Path Planning）
![[Pasted image 20240315215714.png](attach/Pasted%20image%2020240315215714.png)
以机器人为代表的场景中，认为环境是确定的。因此规划指在给定的状态空间X，寻找一个满足一定约束条件的映射$\sigma:[0,1]$。约束包括：
+ 其实状态和目标点区域
+ 避免碰撞$X_{free}$
+ 对路径的微分约束（曲率不能太小，对应二阶导数的约束，曲率越小越平）
优化的目标泛函定义为$J(\sigma)$，具体意义可以表示为路径长度、控制复杂度等

##### 缺点
实际自动驾驶问题中，环境是持续动态变化的，因此需要增加一个维度——时间T，这类问题又称为轨迹规划。

### 3.2 轨迹规划（Trajectory Planning）

![[Pasted image 20240315220324.png](attach/Pasted%20image%2020240315220324.png)
路径规划问题是一个多项式时间内求解的问题，轨迹规划是一个NP-hard问题。


# 4. 算法复杂度

1. 完备性（Completeness）：如果起始点和目标点间有路径解存在，那么一定可以得到解；如果得不到解说明一定没有解。
2. 概率完备性（Probabilistically Completeness）：如果起始目标间有路径解存在，只要规划或搜索时间足够长，就一定能确保找到一条路径解。
3. 最优性（Optimality）：得到的路径在某个评价指标上是最优的
4. 渐进最优性（Asymptotically optimality）：经过有限次迭代后得到的路径是接近最优的次优路径，且每次迭代后斗鱼最优路径更加接近，逐渐收敛的过程


# 预测和规划发展
### 1. 规划输入表示
+ 来自上一个模块的输入
+ 端到端的隐藏层
+ 带有额外中间任务输出的端到端（主流融合方案）

### 2. 输出表示
+ 一系列未来状态和动作，传递给下游控制器。可解释性强。可以方便用于检测碰撞和交通法规等问题
+ 直接输出未来控制动作。端到端多采用该方式。可以提高运行可行性和舒适性。但是产生的行为与对象车辆的个体动力学模型高度相关，不同车辆泛化性受限

## 预测和规划融合策略

### 1. Monolithic E2E
端到端，互相之间关系没有明确建模。有很高的数据要求，且黑盒子性质使得模型自省和安全验证非常困难

### 2. Interpretable E2E
将预测作为辅助的学习任务，作为明确的模型输出。两个任务共享骨干编码特征，输出头分别解码。增加了可解释性，但仍然没有安全性保证。因此需要增加额外的碰撞率测试来额外监督

### 3. Manual integration
人工融合。无法反映EV规划对SV影响。一般先生成候选规划，然后以此进行预测，再选择EV的规划。


## 其它问题
汽车也需要意识到它会影响他人的行为。
### 1. Robot leader planning
基于当前状态给出EV规划，进一步预测整个环境。这会导致攻击性的驾驶行为

### 2. Human leader planning
没有考虑EV对SV的影响，这会导致不自信行为。一般是在考虑SV未来预测结果的情况下EV选择方案，不考虑EV所选规划对SV影响。

### 3. Joint planning
考虑车辆的相互作用，对所有智能体全局优化得到汽车优化，这会导致致命错误（认为周围个体是确定的）

### 4. co-leader planning
周围个体是不确定性的，EV需要在规划步骤中执行应急规划来考虑不确定性。也就是说为多种未来结果做好准备。

## 挑战
### 1. 大规模测试
需要有效方法生成和检索罕见的潜在关键场景。评估对抗鲁棒性

### 2. 系统设计

### 3. 全面的基准测试

### 4. 训练方法
