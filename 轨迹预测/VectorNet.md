---
Title:
---

# 轨迹预测前人研究问题
将高清地图和其它车辆行人渲染成二维图片再卷积学习。存在问题：
1. 每帧都要渲染
2. CNN提取能力有限，只能提取局部信息
3. CNN计算量较大
高清地图本身是高度结构化的，但很多前人工作将不同对象编码为彩色特征。
# 提出解决思路
所有对象（车、路标、车道线、行人）可以抽象为对应的点、矩形或曲线。本文就将相关的对象抽象为基本的Vector矢量格式。
![[Pasted image 20240113222230.png](../img/Pasted%20image%2020240113222230.png)
# 模型
### 1. 轨迹和maps表达
map特征：起始点和方向，等间隔均匀采集关 键点，然后顺序连接相邻关键点
轨迹：等时间间隔采样关键点。
采样间隔越小，越接近原始的图和轨迹
相当于将原来的空间结构化特征转换为无序的Vector set。
而这些vector set可以使用图来表达，并且使用图神经网络来编码。
节点特征可以表达如下：
$$
\mathcal{v}_i = [d^s_i, d^e_i, a_i, j]
$$
分别表达起点坐标、终点坐标、标签特征、vector所属的折线$\mathcal{P}_j$整数id。所有的坐标都转换为目标个体的最后观测点为中心建立坐标（Normalize）。
### 2. 构建折线（polyline）子图（subgraph）
为了利用节点的空间和语义位置，首先在verctor层面构建子图。属于同一个折线的vector节点会被互相连接
对于同一折线的节点{v_1, v_2, ..., v_P}，定义单层的子图传播运算：
$$
v_i^{(l+1)} = \varphi_{rel}(g_{enc}(v_i^{l}), \varphi_{agg}(\{g_{enc}(v_j^{(l)}))
$$
$v_i^{(0)}$是原始输入特征，函数$g_{enc}()$用于transorm个体特征（**MLP，单层全连接+层归一化+ReLU**），$\varphi_{agg}()$用于整合响铃的节点（maxpool），$\varphi_{rel}$是$v_i$和他邻居的关系运算子（拼接运算）。如下图所示：
![[Pasted image 20240116215928.png](../img/Pasted%20image%2020240116215928.png)
最后为了获得polyline层次的特征，计算如下：
$$
P=\varphi_{agg}(\{v_i^{L_p}\})
$$
这里的aggregrate依然是使用maxpooling。
相比起PointNet，文章的节点特征引入起止点和子图信息（顺序信息和类别信息），这更加适合于对结构化标记图和个体轨迹进行编码。
### 3. 用于高维度关系的全局图
全局polyline节点信息$\{P_1, P_2, \cdots, P_P\}$：
$$
\{P_i^{(l+1)}\} = GNN(\{p_i^{(l)}, \mathcal{A}\})
$$
这里的$\mathcal{A}$是邻接矩阵，可以使用启发式的方法构造，如节点间空间距离，为了简单起见，本文将其看作是一个全连接的图。本文的GNN使用的是自注意力操作来实现：
$$
GNN(P) = softmax(P_QP_K^T)P_V
$$
这里的QKV是原始特征P的线性映射（FC）。
解码层如下：
$$
v_i^{future} = \varphi_{traj}(p_i^{(L_t)})
$$
$L_t$是GNN层的数量，$\varphi_{traj}$是解码器（MLP）。可以通过堆叠多层GNN来提取更高维度的特征。
为了更好鼓励模型捕获不同轨迹间关系和映射全局polylines，额外使用了一个辅助任务将图补充完整。在训练时会随机遮住一个节点，如$p_i$，然后尝试恢复这个节点：
$$
\hat{p}_i = \varphi_{node}(p_i^{(L_t)})
$$
这里的node解码器也是MLP。由于借鉴的BERT文章中的特征是有序的，而Polylyline是无序的，所以需要一个identifier，本文使用每个polyline中众vector起始坐标的最小值作为这个Polylineidentifier：
$$
p_i^{(0)}=[P_i; P_i^{id}]
$$
损失函数：
$$
\mathcal{L} = \mathcal{L}_{traj} + \alpha\mathcal{L}_{node}
$$
轨迹损失是负的真实未来轨迹的高斯log似然，节点损失是Huber损失。
# 实验验证
最大的意义在于，不受渲染及核大小的影响，只收vector采样距离的影响，极大降低了参数量和模型所需运算量。

# 总结与讨论
